<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="../d3testing/d3/d3.v3.js"></script>
    </head>
    <body>
<script type="text/javascript">
        
    var dataset;  //Global variable
    var w = 1000;
    var h = 1600;
    var svg = d3.select('body')
                .append('svg')
                .attr('width', w)
                .attr('height',h)
                .attr('fill', 'black');
            
    d3.tsv("cat_eg.tsv", function(data) {
        dataset = data;    //Once loaded, copy to dataset.
        animate();
    });    
         
        
        
        
        
        
        
        
    function animate(){
        svg.selectAll('circle')
            .data(dataset)
            .enter()
            .append('circle')            
                .attr('cx', w/8)
                .attr('cy', function(d, i){return (i*h/dataset.length) + 130;})
                .attr('r', function(d,i){return d.freq/30;
                    })
                .attr('fill', function(d){
                    if(d.evergreen<33/100) {return 'red'}
                    else if (d.evergreen<66/100) {return 'yellow'}
                    else {return 'green'}
                    ;})                    
                .style('stroke', 'black')
                .style('stroke-width',2)
                .on('mousedown', focus)
        ;
        
        svg.selectAll('text.counts')
            .data(dataset)
            .enter()
            .append('text')
            .attr('class','counts')
            .text(function(d){return d.freq;})
                .attr('x', w/1.5)
                .attr('y', function(d, i){return i*h/dataset.length + 130;})
                .attr('text-anchor', 'middle')
                .attr('fill', 'black')
                .attr("dy", ".35em")
                .attr("font-size","20px")

                .attr('font-family', 'sans-serif')
        svg.selectAll('text.cat')
            .data(dataset)
            .enter()
            .append('text')
            .attr('class','cat')
            .text(function(d){return d.alchemy_category;})
                .attr('x', w/2.5)
                .attr('y', function(d, i){return (i*h/dataset.length) + 130;})
                .attr('text-anchor', 'middle')
                .attr('fill', 'black')
                .attr("dy", ".35em")
                .attr("font-size","20px")
                .attr('font-family', 'sans-serif')
                .style("font-weight", "bold")
        ;
    };    
    
    
    
    function focus(){
        d3.select(this).transition()
                .delay(10)
                .duration(1000)
                .attr('cx', function(){
                    if(d3.select(this).attr('cx')<w/2) {return d3.select(this).attr('cx') * 5.3}
                    else {return d3.select(this).attr('cx') / 5.3};
                })
    };
        
        
            
</script>
    </body>
</html>     